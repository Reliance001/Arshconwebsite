<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head') %>
  <body>
    <div class="admin-container">
      <!-- ‚úÖ NAV -->
      <header><%- include('../partials/nav') %></header>

      <h2 class="admin-text-heading">Admin Dashboard</h2>

      <!-- üìÇ ALL PROJECTS SECTION -->
      <div class="admin-section" id="project-list-section">
        <h3 class="admin-text-heading">üìÇ All Projects</h3>

        <% if (projects && projects.length > 0) { %>
        <table id="project-list" class="table table-striped table-bordered">
          <thead class="table-dark">
            <tr>
              <th>Banner</th>
              <th>Title</th>
              <th>Location</th>
              <th>Status</th>
              <th>Completion Date</th>
              <th>Category</th>
              <th>Description</th>
              <th>Stages</th>
              <th>Testimonial</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% projects.forEach(project => { %>
            <tr>
              <td data-label="Banner">
                <% if (project.banner) { %>
                <img
                  src="/uploads/<%= project.banner %>"
                  alt="Banner"
                  style="width: 80px; height: auto; border-radius: 6px"
                />
                <% } else { %> N/A <% } %>
              </td>
              <td data-label="Title"><%= project.title %></td>
              <td data-label="Location"><%= project.location %></td>
              <td data-label="Status"><%= project.status %></td>
              <td data-label="Completion Date">
                <%= project.completionDate ? new
                Date(project.completionDate).toDateString() : "N/A" %>
              </td>
              <td data-label="Category"><%= project.category %></td>
              <td
                data-label="Description"
                style="
                  max-width: 200px;
                  white-space: nowrap;
                  overflow: hidden;
                  text-overflow: ellipsis;
                "
              >
                <%= project.description %>
              </td>
              <td data-label="Stages">
                <% if (project.stages) { %>
                <ul style="list-style: none; padding-left: 0; margin: 0">
                  <% Object.keys(project.stages).forEach(stage => { %>
                  <li>
                    <strong><%= stage %>:</strong>
                    <%= project.stages[stage]?.images?.length || 0 %> imgs
                  </li>
                  <% }) %>
                </ul>
                <% } else { %> N/A <% } %>
              </td>
              <td data-label="Testimonial">
                <% if (project.testimonial && project.testimonial.text) { %>
                "<%= project.testimonial.text %>" ‚Äî
                <em><%= project.testimonial.author %></em>
                <% } else { %> N/A <% } %>
              </td>
              <td data-label="Actions" class="action-section">
                <a
                  class="btn btn-sm btn-outline-primary"
                  href="/admin/edit-project/<%= project._id %>"
                  >‚úèÔ∏è Edit</a
                >
                <form
                  action="/admin/projects/<%= project._id %>/delete"
                  method="POST"
                  onsubmit="return confirm('Delete this project?')"
                >
                  <button type="submit" class="btn btn-sm btn-outline-danger">
                    üóë Delete
                  </button>
                </form>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
        <% } else { %>
        <p>No projects found.</p>
        <% } %>

        <div class="add-project mt-3">
          <a href="/admin/new_project" class="btn btn-success"
            >‚ûï Add New Project</a
          >
        </div>
      </div>

      <!-- üë§ ADMIN INFO SECTION -->
      <div class="admin-section" id="admin-info-section">
        <h3 class="admin-text-heading mb-3">üë§ Admin Information</h3>

        <div class="card shadow-sm p-3 border-0">
          <div class="card-body">
            <p><strong>Full Name:</strong> <%= admin.name %></p>
            <p><strong>Email:</strong> <%= admin.email %></p>
            <p><strong>Role:</strong> <%= admin.role || 'Administrator' %></p>

            <div class="mt-4">
              <a href="/update" class="btn btn-primary w-100">‚úèÔ∏è Update Info</a>
            </div>
            <form action="/logout" method="get" class="mt-2">
              <button type="submit" class="btn btn-danger w-100">Logout</button>
            </form>
          </div>
        </div>
      </div>

      <!-- ‚úÖ FOOTER -->
      <footer><%- include('../partials/footer') %></footer>
    </div>
  </body>
</html>
